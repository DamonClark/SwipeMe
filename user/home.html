{% extends "base.html" %}

{% block head_config %}
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/bootstrap-theme.min.css" rel="stylesheet">
    <link href="../css/bootstrapValidator.min.css" rel="stylesheet">
    <link href="../css/theme.css" rel="stylesheet">
    <link href="../css/home.css" rel="stylesheet">
{% endblock head_config %}

{% block container %}
    <div class="page-header">
        <h1>Profile</h1>
        <h5 onclick="edit_name()">Edit name</h5>
        <h5 onclick="edit_phone_number()">Edit phone number</h5>
    </div>
    <div class="col-sm-4">
        <div class="list-group">
            <a href="#" class="list-group-item active" id="name">{{ name }}</a>
            <a href="#" class="list-group-item">Status: {{ is_active }}</a>
            <a href="#" class="list-group-item">User Type: {{ user_type }}</a>
            <a href="#" class="list-group-item" id="phone_number" >Phone Number: {{ phone_number }}
            </a>
            <a href="#" class="list-group-item">Verified: {{ verified }}</a>
            <a href={{ logout_url }} class="list-group-item">Logout</a>
        </div>
    </div><!-- /.col-sm-4 -->

    <div class="page-header">
        <h1>Active Users</h1>
    </div>
    <div class="col-md-6">
        <table class="table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Name</th>
                    <th>User Type</th>
                </tr>
            </thead>
            <tbody>
                {% for user in active_users %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td>{{ user.google_account.nickname() }}</td>
                    <td>{{ user.user_type_str() }}</td>
                </tr>
                {% endfor %}
      </table>
    </div>

    <!-- Specify symbols to display for validation.-->
    <form role="form" action="javascript:process_form()" id="phone_form"
        data-bv-feedbackicons-valid="glyphicon glyphicon-ok"
        data-bv-feedbackicons-invalid="glyphicon glyphicon-remove"
        data-bv-feedbackicons-validating="glyphicon glyphicon-refresh"
        data-bv-onerror="on_form_invalid(this,event)"
        data-bv-onsuccess="on_form_valid(this,event)">
        <div class="form-group">
            <input type="tel" id="user_phone" name="phone"
            placeholder="314-159-2653"
            data-bv-phone
            data-bv-phone-country="US"
            data-bv-phone-message="Please enter a valid phone number."
            data-bv-notempty="true"
            data-bv-notempty-message="Please enter a valid phone number.">
        </div>
        <button type="submit" class="btn btn-primary">Submit</button>
    </form>


{% endblock container %}

{% block javascript %}
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/bootstrapValidator.min.js"></script>

    <script>
        function edit_name() {
            x = document.getElementById("name");
            x.innerHTML = '<form method="post" action="/user/home/edit"><input type="text" name="name"><input type="submit" value="Submit"></form>';
            x.style.color = 'black';
        }

        function edit_phone_number() {
            x = document.getElementById("phone_form");
            x.style.display = 'block';
        }

    </script>

    <script>
        // initializes Bootstrap Validator plugin
        $(document).ready(function() {
          $('#phone_form').bootstrapValidator()
        });

        function process_form(t,event){
            //Store phone number as string of 10 digits
            var phone_number = $('#user_phone').val();
            phone_number = phone_number.replace(/\D/g,'');

            //Send form data to backend.
            //Redirect to home screen
            $.post("/user/home/edit", {'phone_number' : phone_number}, function(){
              window.location = "home";
            });
        }
  </script>

{% endblock javascript %}