{% extends "base.html" %}

{% block head_config %}
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/bootstrap-theme.min.css" rel="stylesheet">
    <link href="../css/bootstrapValidator.min.css" rel="stylesheet">
    <link href="../css/theme.css" rel="stylesheet">
    <link href="../css/dash.css" rel="stylesheet">
{% endblock head_config %}

{% block container %}
	<div class="modal fade" id="edit_user_modal" tabindex="-1" role="dialog" aria-labelledby="edit_user_modal_title">
		<div class="modal-dialog">
			<div class="modal-content">
				<form role="form" id="edit_user_form">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">
							<span aria-hidden="true">&times;</span>
							<span class="sr-only">Close</span>
						</button>
						<h4 class="modal-title" id="edit_user_modal_title">Edit user settings</h4>
					</div>
					<div class="modal-body">
						<div class="form-group">
							<label for="user_name">Name: </label>
							<input type="text" class="form-control" id="edit_user_name" name="edit_user_name" value="{{ name }}">
						</div>
						<div class="form-group">
							<label for="user_phone">Phone: </label>
							<input type="tel" class="form-control" id="edit_user_phone" name="edit_user_phone" value="{{ phone_number }}">
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
						<button type="button" id="edit_user_submit" class="btn btn-success">Submit</button>
					</div>
				</form>
			</div>
		</div>
	</div>

    <div class="page-header">
        <h1>Profile</h1>
        <h5 id="edit_user_button">Edit</h5>
    </div>
    <div class="col-sm-3">
        <div class="list-group">
            <a href="#" class="list-group-item active" id="name">{{ name }}</a>
            <a href="#" class="list-group-item">Status: {{ is_active }}</a>
            <a href="#" class="list-group-item">User Type: {{ user_type }}</a>
            <a href="#" class="list-group-item" id="phone_number" >Phone Number: {{ phone_number }}
            </a>
            <a href="#" class="list-group-item">Verified: {{ verified }}</a>
            <a href={{ logout_url }} class="list-group-item">Logout</a>
        </div>
    </div><!-- /.col-sm-4 -->

	<div class="container">
		<h2>Active Users</h2>
		<div class="col-sm-9">
			<div class="table-responsive">
				<table class="table table-bordered table-striped table-hover">
					<thead>
						<tr>
							<th>#</th>
							<th>Name</th>
							<th>User Type</th>
						</tr>
					</thead>
					<tbody>
						{% for user in active_users %}
						<tr>
							<td>{{ loop.index }}</td>
							<td>{{ user.google_account.nickname() }}</td>
							<td>{{ user.user_type_str() }}</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		</div><!--/.col-md-6-->
	</div><!--/.container-->
{% endblock container %}

{% block javascript %}
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="../js/bootstrap.min.js"></script>

    <script src="../js/bootstrapValidator.min.js"></script>

    <script>
        // initializes Bootstrap Validator plugin and other event handlers
        $(document).ready(function() {
			$("#edit_user_submit").click(function() {
				update_user();
			});

			$("#edit_user_button").click(function() {
				$("#edit_user_modal").modal();
			});

			$('#edit_user_form').bootstrapValidator({
				feedbackIcons: {
					valid: 'glyphicon glyphicon-ok',
					invalid: 'glyphicon glyphicon-remove',
					validating: 'glyphicon glyphicon-refresh'
				},
				submitButtons: 'button[class="btn-success"]',
				fields: {
					edit_user_name: {
						validators: {
							notEmpty: {
								message: "Please enter your email address."
							},
							emailAddress: {
								message: "Please enter a valid email address."
							}
						}
					},
					edit_user_phone: {
						validators: {
							notEmpty: {
								message: "Please enter your phone number."
							},
							phone: {
								message: "Please enter a valid phone number.",
								country: "US"
							}
						}
					}
				}
			});
        });

		function update_user() {
			$("#edit_user_modal").modal('hide');

			var name = $("#edit_user_name").val();
			var phone = $("#edit_user_phone").val();

			var post_data = {
				'name': name,
				'phone_number': phone
			};

			$.post("/user/dash/edit", post_data, function(data) {
				$("#name").text(name);
				$("#phone_number").text("Phone Number: " + phone);
			});
		}
  </script>

{% endblock javascript %}
