{% extends "base.html" %}

{% block head_config %}
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/bootstrap-theme.min.css" rel="stylesheet">
    <link href="../css/bootstrapValidator.min.css" rel="stylesheet">
    <link href="../css/theme.css" rel="stylesheet">
    <link href="../css/dash.css" rel="stylesheet">
{% endblock head_config %}

{% block container %}
	<div class="modal fade" id="edit_user_modal" tabindex="-1" role="dialog" aria-labelledby="edit_user_modal_title">
		<div class="modal-dialog">
			<div class="modal-content">
				<form role="form" id="edit_user_form">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">
							<span aria-hidden="true">&times;</span>
							<span class="sr-only">Close</span>
						</button>
						<h4 class="modal-title" id="edit_user_modal_title">Edit user settings</h4>
					</div>
					<div class="modal-body">
						<div class="form-group">
							<label for="user_name">Name: </label>
							<input type="text" class="form-control" id="edit_user_name" name="edit_user_name" value="{{ name }}">
						</div>
						<div class="form-group">
							<label for="user_phone">Phone: </label>
							<input type="tel" class="form-control" id="edit_user_phone" name="edit_user_phone" value="{{ phone_number }}" placeholder="4405551234">
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
						<button type="button" id="edit_user_submit" class="btn btn-success">Submit</button>
					</div>
				</form>
			</div>
		</div>
	</div>

    <div class="page-header">
        <h1>Dashboard</h1>
    </div>
    <div class="col-sm-3">
		<table class="table table-bordered">
			<tr>
				<td class="text-right"><strong>Name:</strong></td><td id="name">{{ name }}</td>
			</tr>
			<tr>
				<td class="text-right"><strong>Status:</strong></td><td>{{ is_active }}</td>
			</tr>
			<tr>
				<td class="text-right"><strong>Type:</strong></td><td>{{ user_type }}</td>
			</tr>
			<tr>
				<td class="text-right"><strong>Phone number:</strong></td><td id="phone_number">{{ phone_number }}</td>
			</tr>
			<tr>
				<td class="text-right"><strong>Verified:</strong></td><td>{{ verified }}</td>
			</tr>
		</table>
		<div class="form-group">
			<button class="btn btn-block btn-primary" id="edit_user_button">Edit user</button>
			<button class="btn btn-block btn-danger" id="logout_user">Logout</button>
		</div>
    </div><!-- /.col-sm-4 -->

	<div class="col-sm-9">
		<!--
		<table class="table table-bordered">
			<tr>
				<td class="text-right"><strong>Number of sellers in Market:</strong></td>
				<td>{{ active_user_count }}</td>
			</tr>
			<tr>
				<td class="text-right"><strong>Lowest price:</strong></td>
				<td>{{ minimum_price }}</td>
			</tr>
		</table>
		-->
		<div class="container-fluid">
			<div class="col-xs-6">
				{% if active_user_count == 0 %}
				<div class="alert alert-warning">There are <strong>no</strong> sellers in market.</div>
				{% else %}
				<div class="alert alert-success">There are <strong>{{ active_user_count }}</strong> sellers in market.</div>
				{% endif %}
			</div>
			<div class="col-xs-6">
				<div class="alert alert-info">The current minimum price is <strong>${{ minimum_price }}</strong>.</div>
			</div>
		</div>
		<div class="panel panel-default">
			<div class="panel-heading">
				<h3 class="panel-title">Active Sellers</h3>
			</div>
			<div class="panel-body">
				<ul>
					{% for user in active_users %}
					<li>
						{{ user.google_account.nickname() }}
					</li>
					{% endfor %}
				</ul>
			</div><!--/.panel-body-->
		</div><!--/.panel-->
	</div><!--/.col-sm-9-->
{% endblock container %}

{% block javascript %}
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="../js/bootstrap.min.js"></script>

    <script src="../js/bootstrapValidator.min.js"></script>

    <script>
        // initializes Bootstrap Validator plugin and other event handlers
        $(document).ready(function() {
			$("#edit_user_submit").click(function() {
				update_user();
			});

			$("#edit_user_button").click(function() {
				$("#edit_user_modal").modal();
			});

			$("#logout_user").click(function() {
				window.location.href = "{{ logout_url }}";
			});

			$('#edit_user_form').bootstrapValidator({
				feedbackIcons: {
					valid: 'glyphicon glyphicon-ok',
					invalid: 'glyphicon glyphicon-remove',
					validating: 'glyphicon glyphicon-refresh'
				},
				submitButtons: 'button[class="btn-success"]',
				fields: {
					edit_user_name: {
						validators: {
							notEmpty: {
								message: "Please enter your name."
							}
						}
					},
					edit_user_phone: {
						validators: {
							notEmpty: {
								message: "Please enter your phone number."
							},
							phone: {
								message: "Please enter a valid phone number.",
								country: "US"
							}
						}
					}
				}
			});
        });

		function update_user() {
			$("#edit_user_modal").modal('hide');

			var name = $("#edit_user_name").val();
			var phone = $("#edit_user_phone").val();

			var post_data = {
				'name': name,
				'phone_number': phone
			};

			$.post("/user/dash/edit", post_data, function(data) {
				$("#name").text(name);
				$("#phone_number").text(phone);
			});
		}
  </script>

{% endblock javascript %}
